pragma solidity ^0.8.0;

interface Rip7560SimpleAccountFactory {
    function createAccount(address _owner, uint256 _index) external returns (address);
    function getAddress(address _owner, uint256 _index) external view returns (address);
}

interface Rip7560SimpleAccount {
    function execute(address _to, uint256 _value, bytes calldata _data) external;
}

address constant RIP7560_SIMPLE_ACCOUNT_FACTORY_ADDRESS = 0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0;
address constant RIP7560_SIMPLE_ACCOUNT_EOA_ADDRESS = 0x7c89dDa80039747db454C66E4413002217c3E585;
address constant RIP7560_SIMPLE_ACCOUNT_DEPLOYED_ADDRESS = 0xE2193f998A3E7bE69c39399887aDA4E1E3BD4DCC;
address constant MOCK_ERC20_ADDRESS = 0x5FbDB2315678afecb367f032d93F642f64180aa3;
bytes constant RIP7560_SIMPLE_ACCOUNT_FACTORY_BYTECODE = 
    hex"608060405234801561000f575f80fd5b506004361061003f575f3560e01c806311464fbe146100435780635fbfb9cf146100865780638cb84e1814610099575b5f80fd5b61006a7f000000000000000000000000000000000000000000000000000000000000000081565b6040516001600160a01b03909116815260200160405180910390f35b61006a610094366004610293565b6100ac565b61006a6100a7366004610293565b610174565b5f806100b88484610174565b90506001600160a01b0381163b80156100d35750905061016e565b6040516001600160a01b038616602482015284907f00000000000000000000000000000000000000000000000000000000000000009060440160408051601f198184030181529181526020820180516001600160e01b031663189acdbd60e31b1790525161014090610286565b61014b9291906102c8565b8190604051809103905ff5905080158015610168573d5f803e3d5ffd5b50925050505b92915050565b5f610246825f1b6040518060200161018b90610286565b601f1982820381018352601f9091011660408190526001600160a01b03871660248201527f00000000000000000000000000000000000000000000000000000000000000009060440160408051601f19818403018152918152602080830180516001600160e01b031663189acdbd60e31b179052905161020d939291016102c8565b60408051601f198184030181529082905261022b9291602001610323565b6040516020818303038152906040528051906020012061024d565b9392505050565b5f6102468383305f604051836040820152846020820152828152600b8101905060ff8153605590206001600160a01b0316949350505050565b6103948061034083390190565b5f80604083850312156102a4575f80fd5b82356001600160a01b03811681146102ba575f80fd5b946020939093013593505050565b60018060a01b0383168152604060208201525f82518060408401528060208501606085015e5f606082850101526060601f19601f8301168401019150509392505050565b5f81518060208401855e5f93019283525090919050565b5f610337610331838661030c565b8461030c565b94935050505056fe60806040526040516103943803806103948339810160408190526100229161023c565b61002c8282610033565b505061031b565b61003c82610091565b6040516001600160a01b038316907fbc7cd75a20ee27fd9adebab32041f755214dbc6bffa90cc0225b39da2e5c2d3b905f90a280511561008557610080828261010c565b505050565b61008d61017f565b5050565b806001600160a01b03163b5f036100cb57604051634c9c8ce360e01b81526001600160a01b03821660048201526024015b60405180910390fd5b7f360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc80546001600160a01b0319166001600160a01b0392909216919091179055565b60605f80846001600160a01b0316846040516101289190610305565b5f60405180830381855af49150503d805f8114610160576040519150601f19603f3d011682016040523d82523d5f602084013e610165565b606091505b5090925090506101768583836101a0565b95945050505050565b341561019e5760405163b398979f60e01b815260040160405180910390fd5b565b6060826101b5576101b0826101ff565b6101f8565b81511580156101cc57506001600160a01b0384163b155b156101f557604051639996b31560e01b81526001600160a01b03851660048201526024016100c2565b50805b9392505050565b80511561020f5780518082602001fd5b60405163d6bda27560e01b815260040160405180910390fd5b634e487b7160e01b5f52604160045260245ffd5b5f806040838503121561024d575f80fd5b82516001600160a01b0381168114610263575f80fd5b60208401519092506001600160401b038082111561027f575f80fd5b818501915085601f830112610292575f80fd5b8151818111156102a4576102a4610228565b604051601f8201601f19908116603f011681019083821181831017156102cc576102cc610228565b816040528281528860208487010111156102e4575f80fd5b8260208601602083015e5f6020848301015280955050505050509250929050565b5f82518060208501845e5f920191825250919050565b606d806103275f395ff3fe6080604052600a600c565b005b60186014601a565b6050565b565b5f604b7f360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc546001600160a01b031690565b905090565b365f80375f80365f845af43d5f803e8080156069573d5ff35b3d5ffd";

bytes constant RIP7560_SIMPLE_ACCOUNT_IMPL_BYTECODE =
    hex"60806040526004361061007c575f3560e01c8063ad3cb1cc1161004c578063ad3cb1cc14610118578063b61d27f614610155578063bf45c16614610174578063c4d66de814610193575f80fd5b806347e1da2a146100875780634f1ef286146100a857806352d1902d146100bb5780638da5cb5b146100e2575f80fd5b3661008357005b5f80fd5b348015610092575f80fd5b506100a66100a1366004610d91565b6101b2565b005b6100a66100b6366004610f06565b610330565b3480156100c6575f80fd5b506100cf61034f565b6040519081526020015b60405180910390f35b3480156100ed575f80fd5b505f54610100906001600160a01b031681565b6040516001600160a01b0390911681526020016100d9565b348015610123575f80fd5b50610148604051806040016040528060058152602001640352e302e360dc1b81525081565b6040516100d99190610f51565b348015610160575f80fd5b506100a661016f366004610fc4565b61036a565b34801561017f575f80fd5b506100cf61018e36600461101a565b6103b8565b34801561019e575f80fd5b506100a66101ad366004611051565b6103d5565b6101ba6104e2565b84811480156101d057508215806101d057508281145b6102175760405162461bcd60e51b815260206004820152601360248201527277726f6e67206172726179206c656e6774687360681b60448201526064015b60405180910390fd5b5f8390036102bf575f5b858110156102b9576102b187878381811061023e5761023e61106a565b90506020020160208101906102539190611051565b5f8585858181106102665761026661106a565b9050602002810190610278919061107e565b8080601f0160208091040260200160405190810160405280939291908181526020018383808284375f9201919091525061054992505050565b600101610221565b50610328565b5f5b858110156103265761031e8787838181106102de576102de61106a565b90506020020160208101906102f39190611051565b8686848181106103055761030561106a565b905060200201358585858181106102665761026661106a565b6001016102c1565b505b505050505050565b6103386105bc565b61034182610660565b61034b828261066b565b5050565b5f61035861072c565b505f8051602061123e83398151915290565b6103726104e2565b6103b2848484848080601f0160208091040260200160405190810160405280939291908181526020018383808284375f9201919091525061054992505050565b50505050565b5f6103c1610775565b6103cc8383866107c6565b95945050505050565b7ff0c57e16840df040f15088dc2f81fe391c3923bec73e23a9662efc9c229c6a008054600160401b810460ff16159067ffffffffffffffff165f8115801561041a5750825b90505f8267ffffffffffffffff1660011480156104365750303b155b905081158015610444575080155b156104625760405163f92ee8a960e01b815260040160405180910390fd5b845467ffffffffffffffff19166001178555831561048c57845460ff60401b1916600160401b1785555b61049586610880565b831561032857845460ff60401b19168555604051600181527fc7f505b2f371ae2175ee4913f4499e1f2633a7b5936321eed1cdaeb6115181d29060200160405180910390a1505050505050565b3361756014806104fb57505f546001600160a01b031633145b6105475760405162461bcd60e51b815260206004820181905260248201527f6163636f756e743a206e6f74204f776e6572206f7220456e747279506f696e74604482015260640161020e565b565b5f80846001600160a01b0316848460405161056491906110c1565b5f6040518083038185875af1925050503d805f811461059e576040519150601f19603f3d011682016040523d82523d5f602084013e6105a3565b606091505b5091509150816105b557805160208201fd5b5050505050565b306001600160a01b037f000000000000000000000000000000000000000000000000000000000000000016148061064257507f00000000000000000000000000000000000000000000000000000000000000006001600160a01b03166106365f8051602061123e833981519152546001600160a01b031690565b6001600160a01b031614155b156105475760405163703e46dd60e11b815260040160405180910390fd5b6106686108cc565b50565b816001600160a01b03166352d1902d6040518163ffffffff1660e01b8152600401602060405180830381865afa9250505080156106c5575060408051601f3d908101601f191682019092526106c2918101906110d7565b60015b6106ed57604051634c9c8ce360e01b81526001600160a01b038316600482015260240161020e565b5f8051602061123e833981519152811461071d57604051632a87526960e21b81526004810182905260240161020e565b610727838361091c565b505050565b306001600160a01b037f000000000000000000000000000000000000000000000000000000000000000016146105475760405163703e46dd60e11b815260040160405180910390fd5b61756033146105475760405162461bcd60e51b815260206004820152601c60248201527f6163636f756e743a206e6f742066726f6d20456e747279506f696e7400000000604482015260640161020e565b5f806107d28585610971565b7f19457468657265756d205369676e6564204d6573736167653a0a3332000000005f908152601c859052603c812091925050610813818361018001516109e8565b5f546001600160a01b039081169116146108525760408051606081018252630c59952560e21b8082525f60208301819052919092015292505050610879565b60408051606081018252635fa2e0b360e11b8082525f602083018190529190920152925050505b9392505050565b5f80546001600160a01b0319166001600160a01b03831690811782556040519091617560917fec0419c624b28198777e7294893fe091f48b45dad1fd486dc929cb8e15b2b2609190a350565b5f546001600160a01b03163314806108e357503330145b6105475760405162461bcd60e51b815260206004820152600a60248201526937b7363c9037bbb732b960b11b604482015260640161020e565b61092582610a10565b6040516001600160a01b038316907fbc7cd75a20ee27fd9adebab32041f755214dbc6bffa90cc0225b39da2e5c2d3b905f90a2805115610969576107278282610a73565b61034b610adc565b6109dc604051806101a001604052805f81526020015f6001600160a01b031681526020016060815260200160608152602001606081526020015f81526020015f81526020015f81526020015f81526020015f81526020015f81526020015f8152602001606081525090565b610879828401846110ee565b5f805f806109f68686610afb565b925092509250610a068282610b44565b5090949350505050565b806001600160a01b03163b5f03610a4557604051634c9c8ce360e01b81526001600160a01b038216600482015260240161020e565b5f8051602061123e83398151915280546001600160a01b0319166001600160a01b0392909216919091179055565b60605f80846001600160a01b031684604051610a8f91906110c1565b5f60405180830381855af49150503d805f8114610ac7576040519150601f19603f3d011682016040523d82523d5f602084013e610acc565b606091505b50915091506103cc858383610bfc565b34156105475760405163b398979f60e01b815260040160405180910390fd5b5f805f8351604103610b32576020840151604085015160608601515f1a610b2488828585610c58565b955095509550505050610b3d565b505081515f91506002905b9250925092565b5f826003811115610b5757610b57611229565b03610b60575050565b6001826003811115610b7457610b74611229565b03610b925760405163f645eedf60e01b815260040160405180910390fd5b6002826003811115610ba657610ba6611229565b03610bc75760405163fce698f760e01b81526004810182905260240161020e565b6003826003811115610bdb57610bdb611229565b0361034b576040516335e2f38360e21b81526004810182905260240161020e565b606082610c1157610c0c82610d20565b610879565b8151158015610c2857506001600160a01b0384163b155b15610c5157604051639996b31560e01b81526001600160a01b038516600482015260240161020e565b5080610879565b5f80807f7fffffffffffffffffffffffffffffff5d576e7357a4501ddfe92f46681b20a0841115610c9157505f91506003905082610d16565b604080515f808252602082018084528a905260ff891692820192909252606081018790526080810186905260019060a0016020604051602081039080840390855afa158015610ce2573d5f803e3d5ffd5b5050604051601f1901519150506001600160a01b038116610d0d57505f925060019150829050610d16565b92505f91508190505b9450945094915050565b805115610d305780518082602001fd5b60405163d6bda27560e01b815260040160405180910390fd5b5f8083601f840112610d59575f80fd5b50813567ffffffffffffffff811115610d70575f80fd5b6020830191508360208260051b8501011115610d8a575f80fd5b9250929050565b5f805f805f8060608789031215610da6575f80fd5b863567ffffffffffffffff80821115610dbd575f80fd5b610dc98a838b01610d49565b90985096506020890135915080821115610de1575f80fd5b610ded8a838b01610d49565b90965094506040890135915080821115610e05575f80fd5b50610e1289828a01610d49565b979a9699509497509295939492505050565b80356001600160a01b0381168114610e3a575f80fd5b919050565b634e487b7160e01b5f52604160045260245ffd5b6040516101a0810167ffffffffffffffff81118282101715610e7757610e77610e3f565b60405290565b5f82601f830112610e8c575f80fd5b813567ffffffffffffffff80821115610ea757610ea7610e3f565b604051601f8301601f19908116603f01168101908282118183101715610ecf57610ecf610e3f565b81604052838152866020858801011115610ee7575f80fd5b836020870160208301375f602085830101528094505050505092915050565b5f8060408385031215610f17575f80fd5b610f2083610e24565b9150602083013567ffffffffffffffff811115610f3b575f80fd5b610f4785828601610e7d565b9150509250929050565b602081525f82518060208401528060208501604085015e5f604082850101526040601f19601f83011684010191505092915050565b5f8083601f840112610f96575f80fd5b50813567ffffffffffffffff811115610fad575f80fd5b602083019150836020828501011115610d8a575f80fd5b5f805f8060608587031215610fd7575f80fd5b610fe085610e24565b935060208501359250604085013567ffffffffffffffff811115611002575f80fd5b61100e87828801610f86565b95989497509550505050565b5f805f806060858703121561102d575f80fd5b8435935060208501359250604085013567ffffffffffffffff811115611002575f80fd5b5f60208284031215611061575f80fd5b61087982610e24565b634e487b7160e01b5f52603260045260245ffd5b5f808335601e19843603018112611093575f80fd5b83018035915067ffffffffffffffff8211156110ad575f80fd5b602001915036819003821315610d8a575f80fd5b5f82518060208501845e5f920191825250919050565b5f602082840312156110e7575f80fd5b5051919050565b5f602082840312156110fe575f80fd5b813567ffffffffffffffff80821115611115575f80fd5b908301906101a08286031215611129575f80fd5b611131610e53565b8235815261114160208401610e24565b6020820152604083013582811115611157575f80fd5b61116387828601610e7d565b60408301525060608301358281111561117a575f80fd5b61118687828601610e7d565b60608301525060808301358281111561119d575f80fd5b6111a987828601610e7d565b60808301525060a0838101359082015260c0808401359082015260e080840135908201526101008084013590820152610120808401359082015261014080840135908201526101608084013590820152610180808401358381111561120c575f80fd5b61121888828701610e7d565b918301919091525095945050505050565b634e487b7160e01b5f52602160045260245ffdfe360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc";

